<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>USD1 MLM Registration</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/web3@1.8.2/dist/web3.min.js"></script>
</head>
<body class="bg-gray-100 p-4">
  <main class="max-w-md mx-auto space-y-6">

    <h1 class="text-2xl font-bold text-center">Join USD1 MLM</h1>

    <div class="bg-white p-6 rounded shadow">
      <p class="mb-2"><strong>Connected Wallet:</strong> <span id="walletAddress">Not Connected</span></p>

      <div class="flex justify-between space-x-2 mb-4">
        <button onclick="connectWallet()" id="connectBtn" class="bg-green-500 text-white px-4 py-2 rounded w-1/2">Connect</button>
        <button onclick="disconnectWallet()" id="disconnectBtn" class="bg-red-500 text-white px-4 py-2 rounded w-1/2" disabled>Disconnect</button>
      </div>

      <input type="text" id="referrer" placeholder="Referrer Address" class="border p-2 w-full mb-4">
      <button onclick="register()" class="bg-blue-500 text-white px-4 py-2 rounded w-full">Join System</button>
    </div>

    <p id="status" class="text-center text-green-600"></p>

  </main>

  <script>
    const CONTRACT_ADDRESS = "0x8430347c9fc22c641b8366f834540531920832be";
    const CONTRACT_ABI = [
      {
        "constant": false,
        "inputs": [
          { "internalType": "address", "name": "recipient", "type": "address" },
          { "internalType": "uint256", "name": "amount", "type": "uint256" }
        ],
        "name": "transfer",
        "outputs": [{ "internalType": "bool", "name": "", "type": "bool" }],
        "payable": false,
        "stateMutability": "nonpayable",
        "type": "function"
      },
      {
        "constant": false,
        "inputs": [
          { "internalType": "address", "name": "sender", "type": "address" },
          { "internalType": "address", "name": "recipient", "type": "address" },
          { "internalType": "uint256", "name": "amount", "type": "uint256" }
        ],
        "name": "transferFrom",
        "outputs": [{ "internalType": "bool", "name": "", "type": "bool" }],
        "payable": false,
        "stateMutability": "nonpayable",
        "type": "function"
      }
    ];

    let web3, account, contract;

    async function connectWallet() {
      if (window.ethereum) {
        web3 = new Web3(window.ethereum);
        await window.ethereum.request({ method: "eth_requestAccounts" });
        const accounts = await web3.eth.getAccounts();
        account = accounts[0];
        document.getElementById("walletAddress").innerText = account;
        contract = new web3.eth.Contract(CONTRACT_ABI, CONTRACT_ADDRESS);
        document.getElementById("connectBtn").disabled = true;
        document.getElementById("disconnectBtn").disabled = false;
      } else {
        alert("Install MetaMask");
      }
    }

    function disconnectWallet() {
      account = null;
      document.getElementById("walletAddress").innerText = "Not Connected";
      document.getElementById("connectBtn").disabled = false;
      document.getElementById("disconnectBtn").disabled = true;
    }

    async function register() {
      document.getElementById("status").innerText = "Registering...";
      // TODO: Connect to smart contract register method
      setTimeout(() => {
        document.getElementById("status").innerText = "Registration successful.";
      }, 1000);
    }

    window.onload = () => {
      // optional auto-connect logic can go here
    };
  </script>
</body>
</html>
