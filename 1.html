<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>USD1 MLM Registration</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/web3@1.8.2/dist/web3.min.js"></script>
</head>
<body class="bg-gray-100 p-4">
  <main class="max-w-md mx-auto space-y-6">

    <h1 class="text-2xl font-bold text-center">Join USD1 MLM</h1>

    <div class="bg-white p-6 rounded shadow">
      <p class="mb-2"><strong>Connected Wallet:</strong> <span id="walletAddress">Not Connected</span></p>
      <div class="flex justify-between mb-4">
        <button onclick="connectWallet()" class="bg-green-500 text-white px-4 py-2 rounded">Connect</button>
        <button onclick="disconnectWallet()" class="bg-red-500 text-white px-4 py-2 rounded">Disconnect</button>
      </div>
      <input type="text" id="referrer" placeholder="Referrer Address" class="border p-2 w-full mb-4">
      <button onclick="register()" class="bg-blue-500 text-white px-4 py-2 rounded w-full">Join System</button>
    </div>

    <p id="status" class="text-center text-green-600"></p>

  </main>

  <script>
    const CONTRACT_ADDRESS = "0x8430347c9fc22c641b8366f834540531920832be";
    const CONTRACT_ABI = [
      {
        "constant": false,
        "inputs": [
          { "internalType": "address", "name": "recipient", "type": "address" },
          { "internalType": "uint256", "name": "amount", "type": "uint256" }
        ],
        "name": "transfer",
        "outputs": [{ "internalType": "bool", "name": "", "type": "bool" }],
        "payable": false,
        "stateMutability": "nonpayable",
        "type": "function"
      },
      {
        "constant": false,
        "inputs": [
          { "internalType": "address", "name": "sender", "type": "address" },
          { "internalType": "address", "name": "recipient", "type": "address" },
          { "internalType": "uint256", "name": "amount", "type": "uint256" }
        ],
        "name": "transferFrom",
        "outputs": [{ "internalType": "bool", "name": "", "type": "bool" }],
        "payable": false,
        "stateMutability": "nonpayable",
        "type": "function"
      }
    ];

    let web3, account, contract;

    async function connectWallet() {
      if (window.ethereum) {
        web3 = new Web3(window.ethereum);
        await window.ethereum.request({ method: "eth_requestAccounts" });
        const accounts = await web3.eth.getAccounts();
        account = accounts[0];
        document.getElementById("walletAddress").innerText = account;
        contract = new web3.eth.Contract(CONTRACT_ABI, CONTRACT_ADDRESS);
      } else {
        alert("Install MetaMask");
      }
    }

    function disconnectWallet() {
      account = null;
      document.getElementById("walletAddress").innerText = "Not Connected";
    }

    async function register() {
      document.getElementById("status").innerText = "Registering...";
      try {
        const referrer = document.getElementById("referrer").value;
        if (!web3.utils.isAddress(referrer)) {
          throw new Error("Invalid referrer address");
        }

        // Replace with actual register call when ABI includes it
        // Example: await contract.methods.register(referrer).send({ from: account });

        document.getElementById("status").innerText = "Registration request sent to MetaMask.";
      } catch (error) {
        console.error(error);
        document.getElementById("status").innerText = "Registration failed: " + error.message;
      }
    }

    window.onload = () => {
      connectWallet();
    };
  </script>
</body>
</html>
