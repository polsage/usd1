<!DOCTYPE html>
<html>
<head>
  <title>USD1 MLM Join</title>
  <script src="https://cdn.jsdelivr.net/npm/web3@1.8.2/dist/web3.min.js"></script>
  <style>
    body { font-family: Arial; padding: 20px; }
    input, button { padding: 10px; margin: 5px 0; width: 300px; }
    button { background-color: #28a745; color: white; border: none; cursor: pointer; }
    #status { margin-top: 20px; color: #333; }
  </style>
</head>
<body>

  <h2>Join MLM with USD1 Token</h2>
  <input type="text" id="referrer" placeholder="Enter Referrer Address" />
  <button onclick="joinMLM()">üîó Connect & Join</button>

  <p id="status">Connect your wallet to get started.</p>

  <script>
    const contractAddress = "0xf6a041B825cca4200D8bB909Cf3843fce6e96114";
    const usd1Address = "0x8d0D000Ee44948FC98c9B98A4FA4921476f08B0d";

    const contractABI = [
      {
        "inputs": [{"internalType": "address", "name": "referrer", "type": "address"}],
        "name": "join",
        "outputs": [],
        "stateMutability": "nonpayable",
        "type": "function"
      }
    ];

    const usd1ABI = [
      {
        "inputs": [
          { "internalType": "address", "name": "spender", "type": "address" },
          { "internalType": "uint256", "name": "amount", "type": "uint256" }
        ],
        "name": "approve",
        "outputs": [{ "internalType": "bool", "name": "", "type": "bool" }],
        "stateMutability": "nonpayable",
        "type": "function"
      }
    ];

    let web3, user;

    async function joinMLM() {
      try {
        if (!window.ethereum) {
          alert("MetaMask is not installed!");
          return;
        }

        web3 = new Web3(window.ethereum);
        await window.ethereum.request({ method: 'eth_requestAccounts' });
        const accounts = await web3.eth.getAccounts();
        user = accounts[0];
        document.getElementById("status").innerText = "Wallet connected: " + user;

        const referrer = document.getElementById("referrer").value;
        if (!web3.utils.isAddress(referrer)) {
          alert("Invalid referrer address");
          return;
        }

        const usd1 = new web3.eth.Contract(usd1ABI, usd1Address);
        const contract = new web3.eth.Contract(contractABI, contractAddress);
        const amount = web3.utils.toWei("2", "ether");

        // Step 1: Approve
        document.getElementById("status").innerText = "Step 1: Approving 2 USD1 to contract...";
        await usd1.methods.approve(contractAddress, amount).send({ from: user });

        // Step 2: Join
        document.getElementById("status").innerText = "Step 2: Calling join(referrer)...";
        await contract.methods.join(referrer).send({ from: user });

        document.getElementById("status").innerText = "‚úÖ Successfully joined the system!";
      } catch (error) {
        document.getElementById("status").innerText = "‚ùå Error: " + error.message;
      }
    }
  </script>

</body>
</html>
